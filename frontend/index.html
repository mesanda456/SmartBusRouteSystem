<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöå Advanced Bus Route Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            gap: 20px;
            height: calc(100vh - 180px);
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-y: auto;
        }

        .input-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-dijkstra {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-bfs {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-clear {
            background: #f0f0f0;
            color: #333;
            grid-column: span 2;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .result-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .algorithm-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-dijkstra {
            background: #667eea;
            color: white;
        }

        .badge-bfs {
            background: #f5576c;
            color: white;
        }

        .path-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .stop-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stop-number {
            width: 28px;
            height: 28px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 13px;
        }

        .stop-name {
            font-size: 14px;
            font-weight: 500;
        }

        .stop-id {
            font-size: 11px;
            color: #666;
        }

        .arrow {
            text-align: center;
            color: #667eea;
            font-size: 16px;
            margin: 3px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
        }

        input[type="checkbox"] {
            width: auto;
        }

        .checkbox-label {
            font-size: 13px;
            color: #856404;
            margin: 0;
        }

        .no-result {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .no-result-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .legend {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .dot-blue { background: #4285F4; }
        .dot-green { background: #34A853; }
        .dot-red { background: #EA4335; }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöå Advanced Bus Route Planner</h1>
            <p class="subtitle">Powered by Dijkstra's Algorithm & BFS with Google Maps Integration</p>
        </header>

        <div class="main-layout">
            <!-- LEFT PANEL: Input Controls -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">Plan Your Journey</h3>
                
                <div class="input-group">
                    <label>üìç From (Source)</label>
                    <select id="sourceSelect">
                        <option value="">Select starting point</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>üéØ To (Destination)</label>
                    <select id="destSelect">
                        <option value="">Select destination</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>‚ö° Optimize For</label>
                    <select id="modeSelect">
                        <option value="distance">Shortest Distance (km)</option>
                        <option value="time">Fastest Time (minutes)</option>
                        <option value="cost">Lowest Cost (Rs.)</option>
                    </select>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="emergencyMode">
                    <label for="emergencyMode" class="checkbox-label">
                        üö® Emergency Mode (Safe routes only)
                    </label>
                </div>

                <div class="button-group">
                    <button class="btn-dijkstra" onclick="findRoute('dijkstra')">
                        üéØ Dijkstra
                    </button>
                    <button class="btn-bfs" onclick="findRoute('bfs')">
                        üîç BFS
                    </button>
                    <button class="btn-clear" onclick="clearResults()">
                        üóëÔ∏è Clear
                    </button>
                </div>

                <div class="legend">
                    <strong>Map Legend:</strong>
                    <div class="legend-item">
                        <div class="legend-dot dot-blue"></div>
                        <span>All Bus Stops</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dot-green"></div>
                        <span>Your Route Stops</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dot-red"></div>
                        <span>Route Path</span>
                    </div>
                </div>
            </div>

            <!-- CENTER: Google Map -->
            <div id="map"></div>

            <!-- RIGHT PANEL: Results -->
            <div class="card result-section">
                <div id="resultContainer">
                    <div class="no-result">
                        <div class="no-result-icon">üó∫Ô∏è</div>
                        <h3>No Route Selected</h3>
                        <p style="font-size: 13px;">Choose source and destination to find the best route</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPqia0HFi6I4SRXYwngUKal85mNbhndT0&callback=initMap">
</script>
    <script>
        // ==================== GLOBAL VARIABLES ====================
        let map;
        let markers = [];
        let routeLine = null;
        
        // ==================== DATA STRUCTURES ====================
        
        class BusStop {
            constructor(id, name, lat, lng) {
                this.id = id;
                this.name = name;
                this.latitude = lat;
                this.longitude = lng;
            }
        }

        class Edge {
            constructor(destination, distance, time, cost, safe) {
                this.destination = destination;
                this.distance = distance;
                this.time = time;
                this.cost = cost;
                this.safe = safe;
            }
        }

        class Graph {
            constructor() {
                this.adjList = new Map();
            }

            addStop(stop) {
                if (!this.adjList.has(stop)) {
                    this.adjList.set(stop, []);
                }
            }

            addRoute(from, to, distance, time, cost, safe) {
                this.adjList.get(from).push(new Edge(to, distance, time, cost, safe));
            }
        }

        // ==================== INITIALIZE MAP ====================
        
        function initMap() {
            // Center map on Colombo, Sri Lanka
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: { lat: 6.9271, lng: 79.8612 },
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: true,
                styles: [
                    {
                        featureType: "poi",
                        elementType: "labels",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });

            // Initialize data
            initializeData();
        }

        // ==================== INITIALIZE DATA ====================
        
        const graph = new Graph();
        const busStops = [];

        function initializeData() {
            // Create bus stops (Colombo area coordinates)
            const stops = [
                new BusStop('A', 'Fort Railway Station', 6.9344, 79.8428),
                new BusStop('B', 'Pettah Market', 6.9387, 79.8550),
                new BusStop('C', 'Kollupitiya Junction', 6.9147, 79.8501),
                new BusStop('D', 'Bambalapitiya', 6.8934, 79.8553),
                new BusStop('E', 'Dehiwala Zoo', 6.8569, 79.8742),
                new BusStop('F', 'Mount Lavinia', 6.8389, 79.8630)
            ];

            // Add stops to graph and populate dropdowns
            stops.forEach(stop => {
                busStops.push(stop);
                graph.addStop(stop);
                
                const option = `<option value="${stop.id}">${stop.id} - ${stop.name}</option>`;
                document.getElementById('sourceSelect').innerHTML += option;
                document.getElementById('destSelect').innerHTML += option;
            });

            // Add routes (bidirectional)
            addBidirectionalRoute(stops[0], stops[1], 3, 15, 50, true);   // A <-> B
            addBidirectionalRoute(stops[0], stops[2], 2, 10, 40, true);   // A <-> C
            addBidirectionalRoute(stops[1], stops[3], 4, 20, 60, false);  // B <-> D (unsafe)
            addBidirectionalRoute(stops[2], stops[3], 1, 8, 30, true);    // C <-> D
            addBidirectionalRoute(stops[3], stops[4], 3, 18, 55, true);   // D <-> E
            addBidirectionalRoute(stops[3], stops[5], 5, 25, 70, true);   // D <-> F

            // Display all bus stops on map
            displayAllStops();
        }

        function addBidirectionalRoute(stop1, stop2, distance, time, cost, safe) {
            graph.addRoute(stop1, stop2, distance, time, cost, safe);
            graph.addRoute(stop2, stop1, distance, time, cost, safe);
        }

        // ==================== MAP FUNCTIONS ====================
        
        function displayAllStops() {
            clearMarkers();
            
            busStops.forEach(stop => {
                const marker = new google.maps.Marker({
                    position: { lat: stop.latitude, lng: stop.longitude },
                    map: map,
                    title: `${stop.id} - ${stop.name}`,
                    icon: {
                        url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                    }
                });

                const infoWindow = new google.maps.InfoWindow({
                    content: `<strong>${stop.id}</strong><br>${stop.name}`
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                markers.push(marker);
            });
        }

        function displayRoute(path) {
            clearMarkers();
            clearRouteLine();

            // Display all stops
            displayAllStops();

            // Highlight route stops in green
            const routeCoordinates = [];
            
            path.forEach((stop, index) => {
                const position = { lat: stop.latitude, lng: stop.longitude };
                routeCoordinates.push(position);

                const marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    title: `Stop ${index + 1}: ${stop.name}`,
                    icon: {
                        url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
                    },
                    label: {
                        text: String(index + 1),
                        color: 'white',
                        fontWeight: 'bold'
                    }
                });

                markers.push(marker);
            });

            // Draw route line
            routeLine = new google.maps.Polyline({
                path: routeCoordinates,
                geodesic: true,
                strokeColor: '#EA4335',
                strokeOpacity: 1.0,
                strokeWeight: 4
            });

            routeLine.setMap(map);

            // Fit map to show entire route
            const bounds = new google.maps.LatLngBounds();
            routeCoordinates.forEach(coord => bounds.extend(coord));
            map.fitBounds(bounds);
        }

        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
        }

        function clearRouteLine() {
            if (routeLine) {
                routeLine.setMap(null);
                routeLine = null;
            }
        }

        // ==================== DIJKSTRA ALGORITHM ====================
        
        function dijkstra(source, mode, emergencyOnly) {
            const dist = new Map();
            const prev = new Map();
            const unvisited = new Set();

            graph.adjList.forEach((edges, stop) => {
                dist.set(stop, Infinity);
                prev.set(stop, null);
                unvisited.add(stop);
            });

            dist.set(source, 0);

            while (unvisited.size > 0) {
                let current = null;
                let minDist = Infinity;

                unvisited.forEach(stop => {
                    if (dist.get(stop) < minDist) {
                        minDist = dist.get(stop);
                        current = stop;
                    }
                });

                if (current === null || minDist === Infinity) break;
                unvisited.delete(current);

                const edges = graph.adjList.get(current);
                edges.forEach(edge => {
                    if (emergencyOnly && !edge.safe) return;

                    const weight = mode === 'time' ? edge.time : 
                                 mode === 'cost' ? edge.cost : edge.distance;
                    
                    const alt = dist.get(current) + weight;

                    if (alt < dist.get(edge.destination)) {
                        dist.set(edge.destination, alt);
                        prev.set(edge.destination, current);
                    }
                });
            }

            return { dist, prev };
        }

        // ==================== BFS ALGORITHM ====================
        
        function bfs(start, end) {
            const queue = [start];
            const visited = new Map();
            const prev = new Map();

            visited.set(start, 0);
            prev.set(start, null);

            while (queue.length > 0) {
                const current = queue.shift();

                if (current === end) {
                    const path = [];
                    let node = end;
                    while (node) {
                        path.unshift(node);
                        node = prev.get(node);
                    }
                    return { found: true, path, stops: visited.get(end) };
                }

                const edges = graph.adjList.get(current);
                edges.forEach(edge => {
                    if (!visited.has(edge.destination)) {
                        visited.set(edge.destination, visited.get(current) + 1);
                        prev.set(edge.destination, current);
                        queue.push(edge.destination);
                    }
                });
            }

            return { found: false, path: [], stops: -1 };
        }

        // ==================== ROUTE FINDING ====================
        
        function findRoute(algorithm) {
            const sourceId = document.getElementById('sourceSelect').value;
            const destId = document.getElementById('destSelect').value;
            const mode = document.getElementById('modeSelect').value;
            const emergency = document.getElementById('emergencyMode').checked;

            if (!sourceId || !destId) {
                alert('‚ö†Ô∏è Please select both source and destination!');
                return;
            }

            if (sourceId === destId) {
                alert('‚ö†Ô∏è Source and destination cannot be the same!');
                return;
            }

            const source = busStops.find(s => s.id === sourceId);
            const dest = busStops.find(s => s.id === destId);

            let result;

            if (algorithm === 'dijkstra') {
                const { dist, prev } = dijkstra(source, mode, emergency);
                
                if (dist.get(dest) === Infinity) {
                    displayNoRoute();
                    displayAllStops();
                    return;
                }

                const path = [];
                let current = dest;
                while (current) {
                    path.unshift(current);
                    current = prev.get(current);
                }

                result = {
                    found: true,
                    path: path,
                    total: dist.get(dest),
                    algorithm: 'Dijkstra',
                    mode: mode
                };
            } else {
                const bfsResult = bfs(source, dest);
                
                if (!bfsResult.found) {
                    displayNoRoute();
                    displayAllStops();
                    return;
                }

                result = {
                    found: true,
                    path: bfsResult.path,
                    total: bfsResult.stops,
                    algorithm: 'BFS',
                    mode: 'stops'
                };
            }

            displayResult(result);
            displayRoute(result.path);
        }

        // ==================== DISPLAY RESULTS ====================
        
        function displayResult(result) {
            const container = document.getElementById('resultContainer');
            
            const modeLabels = {
                'distance': 'km',
                'time': 'min',
                'cost': 'Rs.',
                'stops': 'transfers'
            };

            const modeNames = {
                'distance': 'Distance',
                'time': 'Time',
                'cost': 'Cost',
                'stops': 'Transfers'
            };

            let pathHTML = '';
            result.path.forEach((stop, index) => {
                pathHTML += `
                    <div class="stop-item">
                        <div class="stop-number">${index + 1}</div>
                        <div>
                            <div class="stop-name">${stop.name}</div>
                            <div class="stop-id">Stop ${stop.id}</div>
                        </div>
                    </div>
                `;
                if (index < result.path.length - 1) {
                    pathHTML += '<div class="arrow">‚Üì</div>';
                }
            });

            container.innerHTML = `
                <h3>
                    Route Found!
                    <span class="algorithm-badge badge-${result.algorithm.toLowerCase()}">
                        ${result.algorithm}
                    </span>
                </h3>
                
                <div class="path-list">
                    ${pathHTML}
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">${result.total}</div>
                        <div class="stat-label">${modeLabels[result.mode]}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${result.path.length}</div>
                        <div class="stat-label">Stops</div>
                    </div>
                </div>
            `;
        }

        function displayNoRoute() {
            document.getElementById('resultContainer').innerHTML = `
                <div class="no-result">
                    <div class="no-result-icon">‚ùå</div>
                    <h3>No Route Found</h3>
                    <p style="font-size: 13px;">No available path between these locations</p>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('sourceSelect').value = '';
            document.getElementById('destSelect').value = '';
            document.getElementById('emergencyMode').checked = false;
            clearRouteLine();
            displayAllStops();
            
            document.getElementById('resultContainer').innerHTML = `
                <div class="no-result">
                    <div class="no-result-icon">üó∫Ô∏è</div>
                    <h3>No Route Selected</h3>
                    <p style="font-size: 13px;">Choose source and destination to find the best route</p>
                </div>
            `;
        }
    </script>
</body>
</html>